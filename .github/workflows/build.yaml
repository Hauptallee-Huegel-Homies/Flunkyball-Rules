name: build

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - '*'

jobs:
  linux_manual:
    name: "🐧 Linux Manual 🛠️"
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout project
        uses: actions/checkout@v2
      - name: Create build/latex/
        run: mkdir -p build/latex/
      - name: Build Markdown (rules/en.md) to Latex (build/latex/en.tex)
        uses: docker://pandoc/latex:2.14.0.1
        with:
          args: >-
            --from markdown
            --to latex
            --output build/latex/en.tex 
            rules/en.md
      - name: "Adapt Latex (build/latex/en.tex): Remove ad-hoc label enumeration"
        run: sed -i '/\\def\\labelenumi/d' build/latex/en.tex
      - name: "Adapt Latex (build/latex/en.tex): Add {} to terminate \\tightlist"
        run: sed -i 's/\\tightlist/\\tightlist{}/' build/latex/en.te
      - name: "Compile Latex (latex/en.tex --> build/latex/en.pdf)"
        uses: xu-cheng/latex-action@v2
        with:
          root_file: latex/en.tex
          latexmk_use_lualatex: true
          args: >-
            -cd-
            -output-directory=build/latex/
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y-%m-%d')"
      - name: "Upload PDFs"
        uses: actions/upload-artifact@v2
        with:
          name: English PDF - ${{ steps.date.outputs.date }}
          path: build/latex/en.pdf



